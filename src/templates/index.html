<!DOCTYPE html>
<html>
<head>
    <title>Network Web Server - Data & Terminal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="header">
        <h1>ğŸŒ Network Web Server</h1>
        <p>Data Storage & Command Terminal</p>
        <div style="margin-top:10px; display: flex; gap: 10px; justify-content: center;">
            <a href="/dashboard" style="text-decoration:none;">
                <button>ğŸ“ˆ Backend Dashboard</button>
            </a>
            <a href="/voice-chat" style="text-decoration:none;">
                <button style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">ğŸ¤ Voice Chat</button>
            </a>
        </div>
    </div>
    
    <div class="container">
        <!-- Mobile App Controls Section -->
        <div class="section full-width" style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); border: 2px solid #4a90e2;">
            <h2 style="color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">ğŸ“± Mobile App Controls</h2>
            <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <!-- Tunnel Control -->
                    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px;">
                        <h3 style="color: #fff; margin-top: 0;">ğŸ”’ Secure Tunnel for Mobile</h3>
                        <div id="mobileTunnelStatus" style="padding: 10px; background: rgba(255,255,255,0.2); border-radius: 6px; margin-bottom: 15px; color: #fff;">
                            <span id="tunnelStatusDot" style="display: inline-block; width: 12px; height: 12px; border-radius: 50%; background: #ff3b30; margin-right: 8px;"></span>
                            <span id="tunnelStatusText">Tunnel: Stopped</span>
                        </div>
                        <div id="mobileTunnelUrl" style="display: none; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 6px; margin-bottom: 15px; color: #fff; word-break: break-all;">
                            <strong>Tunnel URL:</strong><br>
                            <a id="tunnelUrlLink" href="#" target="_blank" style="color: #4fc3f7; text-decoration: none;">Loading...</a>
                        </div>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <button id="startMobileTunnelBtn" onclick="startMobileTunnel()" style="flex: 1; background: #34c759; font-size: 16px; padding: 12px;">
                                â–¶ï¸ Start Tunnel
                            </button>
                            <button id="stopMobileTunnelBtn" onclick="stopMobileTunnel()" style="flex: 1; background: #ff3b30; font-size: 16px; padding: 12px;" disabled>
                                â¹ Stop Tunnel
                            </button>
                        </div>
                        <button onclick="checkMobileTunnelStatus()" style="width: 100%; background: #007bff; font-size: 14px; padding: 10px;">
                            ğŸ”„ Refresh Status
                        </button>
                        <p style="font-size: 12px; color: #e0e0e0; margin: 10px 0 0 0;">
                            ğŸ’¡ Start the tunnel only when you need remote mobile access. Keep it stopped for local network use.
                        </p>
                    </div>

                    <!-- APK Download -->
                    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px;">
                        <h3 style="color: #fff; margin-top: 0;">ğŸ“² Download Mobile App</h3>
                        <div style="padding: 15px; background: rgba(255,255,255,0.2); border-radius: 6px; margin-bottom: 15px; text-align: center;">
                            <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“±</div>
                            <p style="color: #fff; margin: 0 0 15px 0;">Get the Android app to access your server from anywhere</p>
                            <button onclick="downloadAPK()" style="width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-size: 16px; padding: 15px; border: none; cursor: pointer; border-radius: 8px; color: white; font-weight: bold;">
                                ğŸ“¥ Download APK
                            </button>
                        </div>
                        <div style="font-size: 12px; color: #e0e0e0;">
                            <strong>Installation Steps:</strong><br>
                            1. Click "Download APK" above<br>
                            2. Enable "Install from Unknown Sources" in Android settings<br>
                            3. Open the downloaded APK file<br>
                            4. Follow installation prompts<br>
                            5. Open app and connect!
                        </div>
                    </div>
                </div>
            </div>
            <div id="mobileAppOutput" class="output" style="background: rgba(0,0,0,0.3); color: #fff;">
                Mobile app controls ready. Start the tunnel to enable remote mobile access.
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“Š Data Storage</h2>
            <div class="flex-row">
                <input type="text" id="dataKey" placeholder="Enter key name">
                <button onclick="getData()">Get</button>
                <button onclick="deleteData()" class="danger">Delete</button>
            </div>
            <textarea id="dataValue" placeholder="Enter any text or JSON... (auto-detects format)" rows="6"></textarea>
            <div>
                <button onclick="storeData()">ğŸ’¾ Store Data</button>
                <button onclick="getAllData()">ğŸ“‹ Get All Data</button>
                <button onclick="clearOutput('dataOutput')">ğŸ—‘ï¸ Clear</button>
            </div>
            <div id="dataOutput" class="output">Ready for data operations...</div>
        </div>
        
        <div class="section">
            <h2>ğŸ’» Command Terminal</h2>
            <div style="background: #2d2d2d; padding: 10px; border-radius: 4px; margin-bottom: 15px; font-size: 12px;">
                <span style="color: #00ff00;">â—</span> Connected to: <strong id="machineInfo">Loading...</strong>
                <br>
                <span style="color: #ffff00;">âš¡</span> Commands execute directly on the server machine with full access to the filesystem
            </div>
            <div class="flex-row" style="margin-bottom: 10px;">
                <select id="commandType" onchange="toggleSudoPassword()" style="flex: 0 0 150px;">
                    <option value="normal">Normal User</option>
                    <option value="sudo">Root (sudo)</option>
                </select>
                <label style="display: flex; align-items: center; gap: 5px; margin-left: 10px;">
                    <input type="checkbox" id="interactiveMode" style="width: auto;">
                    <span style="font-size: 13px;">Interactive Mode</span>
                </label>
                <label style="display: flex; align-items: center; gap: 5px; margin-left: 10px;">
                    <input type="checkbox" id="persistentTerminal" onchange="togglePersistentTerminal()" style="width: auto;">
                    <span style="font-size: 13px; color: #00ff00;">ğŸ–¥ï¸ Persistent Terminal (cd, env vars)</span>
                </label>
                <button onclick="clearOutput('commandOutput')" style="margin-left: auto;">ğŸ—‘ï¸ Clear</button>
            </div>
            <div id="sudoPasswordSection" style="display: none; margin: 10px 0;">
                <input type="password" id="sudoPassword" placeholder="Enter sudo password..." style="width: 100%;">
                <div style="font-size: 12px; color: #ffff00; margin: 5px 0;">
                    âš ï¸ Password is only used for this command and not stored anywhere
                </div>
            </div>
            <div class="flex-row">
                <input type="text" id="command" placeholder="Enter command (e.g., ls, pwd, apt update)..." onkeypress="handleCommandEnter(event)">
                <button onclick="executeCommand()">â–¶ï¸ Execute</button>
            </div>
            <div id="interactiveSection" style="display: none; margin: 10px 0; padding: 10px; background: #2d2d2d; border-radius: 4px;">
                <div style="margin-bottom: 10px; color: #ffff00;">
                    â³ Command is waiting for input...
                </div>
                <div class="flex-row" style="margin-bottom: 10px;">
                    <input type="text" id="interactiveInput" placeholder="Enter response..." onkeypress="handleInteractiveEnter(event)" style="flex: 1;">
                    <button onclick="sendInteractiveResponse()">ğŸ“¤ Send</button>
                </div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="sendQuickResponse('y')" style="background: #28a745;">âœ… Yes (y)</button>
                    <button onclick="sendQuickResponse('n')" style="background: #dc3545;">âŒ No (n)</button>
                    <button onclick="sendQuickResponse('Y')" style="background: #28a745;">âœ… YES (Y)</button>
                    <button onclick="sendQuickResponse('N')" style="background: #dc3545;">âŒ NO (N)</button>
                    <button onclick="sendQuickResponse('')" style="background: #6c757d;">â Enter</button>
                    <button onclick="sendQuickResponse('q')" style="background: #fd7e14;">ğŸšª Quit (q)</button>
                </div>
            </div>
            <div>
                <button onclick="quickCommand('ls -la')">ğŸ“ List Files</button>
                <button onclick="quickCommand('pwd')">ğŸ“ Current Dir</button>
                <button onclick="quickCommand('whoami')">ğŸ‘¤ User Info</button>
                <button onclick="quickCommand('df -h')">ğŸ’¿ Disk Space</button>
            </div>
            <div id="commandOutput" class="output terminal-output">Terminal ready. Type commands above...</div>
            <div style="font-size: 12px; color: #888; margin-top: 5px;">
                ğŸ’¡ All command output is displayed. Long outputs are scrollable. Commands timeout after 60 seconds.
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ“ File Storage</h2>
            <div style="margin-bottom: 15px;">
                <input type="file" id="fileInput" multiple style="margin: 8px 0;">
                <div style="display: flex; gap: 10px; margin: 10px 0;">
                    <button onclick="uploadFiles()">ğŸ“¤ Upload Files</button>
                    <button onclick="refreshFiles()">ğŸ”„ Refresh List</button>
                    <button onclick="clearOutput('fileOutput')">ğŸ—‘ï¸ Clear</button>
                </div>
                <div id="storageInfo" style="background: #3d3d3d; padding: 10px; border-radius: 4px; margin: 10px 0; font-size: 12px;">
                    Storage: Loading...
                </div>
            </div>
            <div id="fileList" style="max-height: 300px; overflow-y: auto; background: #3d3d3d; border-radius: 4px; padding: 10px; margin: 10px 0;">
                <div style="text-align: center; color: #888;">Loading files...</div>
            </div>
            <div id="fileOutput" class="output">Ready for file operations...</div>
        </div>
        
        <div class="section full-width">
            <h2>ğŸŒ Public Tunnel Control</h2>
            <div style="margin-bottom: 20px;">
                <h3>Choose Your Tunneling Service:</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div style="border: 1px solid #444; padding: 15px; border-radius: 8px;">
                        <h4 style="color: #ffff00; margin: 0 0 10px 0;">ğŸ”§ Ngrok (Traditional)</h4>
                        <p style="font-size: 12px; margin: 0 0 10px 0;">Requires clicking through warning page</p>
                        <button onclick="startNgrok()" style="width: 100%; margin-bottom: 5px;">ğŸš€ Start Ngrok</button>
                        <button onclick="stopNgrok()" class="danger" style="width: 100%;">ğŸ›‘ Stop Ngrok</button>
                    </div>
                    <div style="border: 1px solid #444; padding: 15px; border-radius: 8px;">
                        <h4 style="color: #00ff00; margin: 0 0 10px 0;">âš¡ Localtunnel (No Warnings)</h4>
                        <p style="font-size: 12px; margin: 0 0 10px 0;">Free, no warning pages, easy setup</p>
                        <button onclick="startLocaltunnel()" style="width: 100%; margin-bottom: 5px;">ğŸš€ Start Localtunnel</button>
                        <button onclick="stopLocaltunnel()" class="danger" style="width: 100%;">ğŸ›‘ Stop Localtunnel</button>
                    </div>
                    <div style="border: 1px solid #444; padding: 15px; border-radius: 8px;">
                        <h4 style="color: #00ccff; margin: 0 0 10px 0;">â˜ï¸ Cloudflared (Cloudflare)</h4>
                        <p style="font-size: 12px; margin: 0 0 10px 0;">Enterprise-grade, very reliable</p>
                        <button onclick="startCloudflared()" style="width: 100%; margin-bottom: 5px;">ğŸš€ Start Cloudflared</button>
                        <button onclick="stopCloudflared()" class="danger" style="width: 100%;">ğŸ›‘ Stop Cloudflared</button>
                    </div>
                </div>
                <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 15px;">
                    <button onclick="checkAllTunnelStatus()">ğŸ”„ Check All Status</button>
                    <button onclick="stopAllTunnels()" class="danger">ğŸ›‘ Stop All Tunnels</button>
                    <span id="tunnelStatus" style="padding: 8px 15px; border-radius: 4px; background: #444;">Status: No active tunnels</span>
                </div>
            </div>
            <div id="tunnelOutput" class="output">
                <strong>ğŸŒ Public Tunnel Services:</strong><br>
                <strong>ğŸ”§ Ngrok:</strong> Traditional choice, but has warning page on free tier<br>
                <strong>âš¡ Localtunnel:</strong> No warning pages, simple setup: <code>npm install -g localtunnel</code><br>
                <strong>â˜ï¸ Cloudflared:</strong> Cloudflare's tunnel, very reliable: <code>curl -L cloudflare.com/a/warp | bash</code><br><br>
                <em style="color: #00ff00;">ğŸ’¡ Recommendation:</em> Try Localtunnel first - it's the easiest with no warnings!<br>
                Click any "Start" button above to create a public URL that anyone can access.
            </div>
        </div>
        
        <div class="section full-width">
            <h2>âš¡ Program Management</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h3>ğŸ“¤ Upload Program</h3>
                    <div style="margin-bottom: 20px;">
                        <div style="margin-bottom: 10px;">
                            <label style="margin-right: 10px;">
                                <input type="radio" name="uploadType" value="single" checked onchange="toggleUploadType()"> Single File
                            </label>
                            <label>
                                <input type="radio" name="uploadType" value="multiple" onchange="toggleUploadType()"> Multiple Files/Project
                            </label>
                        </div>
                        
                        <!-- Single file upload form -->
                        <form id="programUploadForm" enctype="multipart/form-data" style="margin-bottom: 15px;">
                            <input type="file" id="programFile" accept=".py,.sh,.bash,.js,.pl,.rb,*" style="margin-bottom: 10px;" required>
                            <input type="text" id="programDescription" placeholder="Program description (optional)" style="margin-bottom: 10px;">
                            <button type="submit">ğŸ“¤ Upload Program</button>
                        </form>
                        
                        <!-- Multiple files upload form -->
                        <form id="multipleUploadForm" enctype="multipart/form-data" style="margin-bottom: 15px; display: none;">
                            <input type="file" id="multipleFiles" multiple webkitdirectory style="margin-bottom: 10px; display: none;">
                            <input type="file" id="multipleFilesRegular" multiple style="margin-bottom: 10px;">
                            <div style="margin-bottom: 10px;">
                                <button type="button" onclick="selectFolder()" style="background: #007acc; margin-right: 10px;">ğŸ“ Select Folder</button>
                                <button type="button" onclick="selectMultipleFiles()" style="background: #007acc;">ğŸ“„ Select Multiple Files</button>
                            </div>
                            <input type="text" id="projectName" placeholder="Project name (optional)" style="margin-bottom: 10px;">
                            <input type="text" id="projectDescription" placeholder="Project description (optional)" style="margin-bottom: 10px;">
                            <div id="fileList" style="margin-bottom: 10px; max-height: 150px; overflow-y: auto; border: 1px solid #444; padding: 10px; display: none;"></div>
                            <button type="submit" id="uploadMultipleBtn" disabled>ğŸ“¤ Upload Project</button>
                        </form>
                    </div>
                    <div id="programUploadOutput" class="output">Select a program file to upload...</div>
                </div>
                <div>
                    <h3>ğŸ“‹ Program List</h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button onclick="loadProgramList()">ğŸ”„ Refresh List</button>
                        <button onclick="deleteAllPrograms()" class="danger">ğŸ—‘ï¸ Delete All Programs</button>
                        <button onclick="deleteSelectedPrograms()" class="danger" id="deleteSelectedBtn" style="display: none;">ğŸ—‘ï¸ Delete Selected</button>
                        <button onclick="toggleSelectAll()" id="selectAllBtn" style="background: #007acc;">â˜‘ï¸ Select All</button>
                    </div>
                    <div id="programList" class="output" style="max-height: 200px; overflow-y: auto;">Loading programs...</div>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <h3>â–¶ï¸ Execute Program</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <select id="selectedProgram" style="flex: 1;" onchange="handleProgramSelection()">
                        <option value="">Select a program to execute...</option>
                    </select>
                    <select id="programExecutionType" style="width: 150px;">
                        <option value="normal">Normal</option>
                        <option value="sudo">Root (sudo)</option>
                    </select>
                </div>
                
                <!-- Terminal Input Section for Projects -->
                <div id="projectTerminalSection" style="display: none; margin-bottom: 15px; padding: 15px; background: #2d2d2d; border-radius: 6px; border-left: 4px solid #9370db;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <span style="color: #9370db; font-weight: bold;">ğŸ“ Project Terminal Mode</span>
                        <span style="font-size: 11px; color: #888;">(Navigate and run commands in project directory)</span>
                    </div>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="text" id="projectTerminalCommand" placeholder="Enter command (e.g., python script.py, ls, cd subdir && python main.py)..." style="flex: 1;" onkeypress="handleProjectTerminalEnter(event)">
                        <button onclick="executeProjectTerminal()">â–¶ï¸ Run</button>
                    </div>
                    <div style="font-size: 11px; color: #ffff00;">
                        ğŸ’¡ Tip: Use full commands like "python3 script.py" or "bash install.sh"
                    </div>
                </div>
                
                <!-- Traditional Arguments Section -->
                <div id="traditionalArgsSection" style="margin-bottom: 10px;">
                    <input type="text" id="programArgs" placeholder="Arguments (optional)" style="width: 100%;">
                </div>
                
                <div id="programSudoPassword" style="display: none; margin-bottom: 10px;">
                    <input type="password" id="programSudoPasswordInput" placeholder="Enter sudo password">
                </div>
                <div style="margin-bottom: 10px;">
                    <label style="cursor: pointer; font-size: 12px;">
                        <input type="checkbox" id="programInteractive">
                        Run in interactive mode
                    </label>
                </div>
                <button onclick="executeSelectedProgram()">â–¶ï¸ Execute Program</button>
                <div id="programExecutionOutput" class="output">Select a program and click execute...</div>
                <div id="programInteractiveSection" style="display: none; margin-top: 10px;">
                    <input type="text" id="programInteractiveInput" placeholder="Enter input..." onkeypress="handleProgramInteractiveEnter(event)">
                    <button onclick="sendProgramInteractiveResponse()">Send</button>
                </div>
            </div>
        </div>
        
        <div class="section full-width">
            <h2>ğŸ“ˆ System Information</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <button onclick="quickCommand('uname -a')">ğŸ–¥ï¸ System Info</button>
                <button onclick="quickCommand('ps aux | head -10')">âš¡ Top Processes</button>
                <button onclick="quickCommand('free -h')">ğŸ§  Memory Usage</button>
                <button onclick="quickCommand('uptime')">â±ï¸ Uptime</button>
                <button onclick="quickCommand('ip addr show')">ğŸŒ Network Info</button>
                <button onclick="quickCommand('lscpu')">ğŸ”§ CPU Info</button>
            </div>
            <div id="systemOutput" class="output">Click a system info button to see details...</div>
        </div>
        
        <div class="section full-width">
            <h2>ğŸ“ Programs Terminal</h2>
            <div style="background: #2d2d2d; padding: 10px; border-radius: 4px; margin-bottom: 15px; font-size: 12px;">
                <span style="color: #9370db;">â—</span> Working Directory: <strong id="programsTerminalPath">Loading...</strong>
                <br>
                <span style="color: #00ff00;">âš¡</span> Persistent terminal session - navigate and run commands in the programs directory
                <br>
                <span style="color: #ffff00;">ğŸ’¡</span> All uploaded programs are stored here. Use commands like: <code>ls</code>, <code>cd project_folder</code>, <code>python3 script.py</code>
            </div>
            <div class="flex-row">
                <input type="text" id="programsTerminalCommand" placeholder="Enter command (e.g., ls, cd project_1234/myapp, python3 main.py)..." onkeypress="handleProgramsTerminalEnter(event)">
                <button onclick="executeProgramsTerminal()">â–¶ï¸ Execute</button>
            </div>
            <div style="margin: 10px 0;">
                <button onclick="quickProgramsCommand('ls -la')">ğŸ“ List All</button>
                <button onclick="quickProgramsCommand('pwd')">ğŸ“ Current Dir</button>
                <button onclick="quickProgramsCommand('ls -lR')">ğŸ—‚ï¸ Tree View</button>
                <button onclick="quickProgramsCommand('du -sh *')">ğŸ’¿ Folder Sizes</button>
                <button onclick="clearOutput('programsTerminalOutput')">ğŸ—‘ï¸ Clear</button>
            </div>
            <div id="programsTerminalOutput" class="output terminal-output">Programs terminal ready. Type commands above...</div>
            <div style="font-size: 12px; color: #888; margin-top: 5px;">
                ğŸ’¡ This terminal stays in the programs directory. Navigate between projects with 'cd'. Use 'cd ..' to go up, 'cd ~' to return to programs root.
            </div>
        </div>
    </div>

    <div class="status-bar">
        <span id="serverStatus">ğŸŸ¢ Server Connected</span> | 
        <span id="networkInfo">Network Access Enabled</span> |
        <span id="timestamp"></span>
    </div>

    <script src="{{ url_for('static', filename='main.js') }}"></script>
</body>
</html>
